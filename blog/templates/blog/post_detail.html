{% extends "blog/base.html" %}
{% load static %}
{% load ratings %}
{% block content %}

    <link href="{% static 'mdeditor/css/editormd.min.css' %}" rel="stylesheet">
    <link href="{% static 'mdeditor/css/editormd.preview.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'star-ratings/css/star-ratings.css' %}">
    <script type="text/javascript" src="{% static 'star-ratings/js/dist/star-ratings.min.js' %}"></script>

    <section class="ecg-section ecg-heading">
        <div class="container">
         <div class="row">
            <div class="col-md-8">
              <p class="breadcrumbs"><span class="mr-2"><a href="{% url 'blog-home' %}">Strona główna</a></span> <span class="mr-2"><a href="{% url 'blog-about' %}">Kursy</a></span> <span>{{ object.title }}</span></p>
              <h1 class="bread">{{ object.title }} </h1>
            </div>
         </div>
      </div>
    </section>

    <nav class="navbar navbar-light bg-white justify-content-end d-xl-none">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </nav>

    <div class="modal fade" tabindex="-1" role="dialog" id="modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content"></div>
      </div>
    </div>

    <div class="container">
        <!-- main content -->
        <div class="row mt-5 pt-5">
          <div class="col-xl-8 py-5">
          {%if object.author == user or user.profile.moderator == True%}
          <div class="row ">
              <button class="btn-hover-update" onclick="location.href='{% url 'post-update' object.id %}'"><span>Edit</span></button>
              <button class="btn-hover-add" onclick="location.href='{% url 'post-upload' object.id %}'"><span>Upload</span></button>
              <button class="delete-post btn-hover-delete" data-id="{% url 'post-delete' object.id %}"><span>Delete</span></button>
              <hr class="bd-dark mt-4 mb-4">
          </div>

        {% endif %}

          <div id="content">
              <textarea>{{ object.content }}</textarea>
          </div>

              {% if user.is_authenticated%}
             <hr>
                <button class="create-comment btn-hover-add" style="width: 40%;" type="button" name="button"><span>Add comment</span></button>
            {% endif %}
          <hr>

          <h3> Comments: {{ post.comments.count }}</h3>
        {% for comment in post.comments.all %}
            <article class="media comment-section">
            <img class="rounded-circle article-img" src="{{ object.author.profile.image.url }}">
            <div class="media-body">
              <div class="article-metadata">
                <a class="mr-2">{{ comment.author.get_full_name }}</a>
                  <small class="text-muted">{{ comment.created_date|date:"d.m.Y"  }}</small>
                  {%if object.author == user or user.profile.moderator == True%}
                      <button type="button" class="delete-comment btn justify-content-end" data-id="{% url 'comment-delete' comment.pk %}"><span><i class="fas fa-trash-alt text-danger d-flex " ></i></span></button>
              {% endif %}
              </div>
              <p class="article-content">{{ comment.text|linebreaks }}</p>
            </div>
          </article>
        {% endfor %}
    </div>

    <div class="col-xl-4 p-xl-0">
        <div class="sidebar-box p-3">
          <div class="mt-3 mb-5"><h3 class="sidebar-heading">Download materials</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus itaque, autem necessitatibus voluptate quod mollitia delectus aut.</p>
            <a href="{% url 'post-download' object.id %}" style="color: #ccb78f;"> Download </a></div>
          <div class="mt-5 mb-3"><h3 class="sidebar-heading">Paragraph</h3>
            {% ratings object %}
              <hr class="bg-white">
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus itaque, autem necessitatibus voluptate quod mollitia delectus aut.</p></div>
        </div>
    </div>

</div>
<!-- .main content -->
</div>

<script src="{% static 'mdeditor/js/jquery.min.js' %}"></script>
<script src="{% static 'mdeditor/js/editormd.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/marked.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/prettify.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/raphael.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/underscore.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/sequence-diagram.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/flowchart.min.js' %}"></script>
<script src="{% static 'mdeditor/js/lib/jquery.flowchart.min.js' %}"></script>
<script>
  $(function () {
      editormd.markdownToHTML("content", {
          emoji           : true,
          taskList        : true,
          tex             : true,
          flowChart       : true,
          sequenceDiagram : true,
      });

      $(".reference-link").each(function (i,obj) {
        console.log(obj)
      })
  })

</script>
<script type="text/javascript">
  $(function () {
    $(".create-comment").modalForm({formURL: "{% url 'add_comment_to_post' pk=post.pk  %}"});
    $(".delete-comment").each(function () {
        $(this).modalForm({formURL: $(this).data('id')});
      });
      $(".delete-post").each(function () {
        $(this).modalForm({formURL: $(this).data('id')});
      });

  });
</script>

{% endblock %}


